<!DOCTYPE html><html lang="en"> <head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link rel="shortcut icon" href="/static/img/favicon.ico"><link rel="icon" type="image/png" href="/static/img/favicon-384x384.png" sizes="384x384"><link rel="apple-touch-icon" sizes="180x180" href="/static/img/apple-touch-icon.png"><meta name="theme-color" content="#343a40"><link rel="canonical" href="https://nitratine.net/blog/post/encryption-and-decryption-in-python/"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous"><link rel="stylesheet" href="/static/css/base.css"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-117153268-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);};gtag('js',new Date());gtag('config','UA-117153268-2');</script><script defer src="https://instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script><title>Encryption and Decryption in Python - Nitratine</title><link rel="stylesheet" href="/static/css/blog.css"><link rel="stylesheet" href="/static/css/pygments.css"><meta name="description" content="In this post, I discuss how to encrypt and decrypt messages in Python using symmetric encryption. I will demonstrate how to create keys, save keys and how to encrypt messages and text."><meta name="author" content="Brent Vollebregt"><meta property="og:title" content="Encryption and Decryption in Python"><meta property="og:description" content="In this post, I discuss how to encrypt and decrypt messages in Python using symmetric encryption. I will demonstrate how to create keys, save keys and how to encrypt messages and text."><meta property="og:image" content="/posts/encryption-and-decryption-in-python/youtube-thumbnail.jpg"><meta property="og:url" content="https://nitratine.net/blog/post/encryption-and-decryption-in-python/"><meta name="twitter:card" content="summary"><script data-ad-client="ca-pub-6407227183932047" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head> <body> <nav class="navbar navbar-expand-md navbar-dark bg-dark sticky-top"> <div class="container"> <a class="navbar-brand" href="/"> <img src="/static/img/logo.png" width="145" height="30" class="d-inline-block align-top" alt="Brand Icon"> </a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <div class="collapse navbar-collapse justify-content-between" id="navbar"> <ul class="navbar-nav mr-auto"> <li class="nav-item "> <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog</a> </li> <li class="nav-item"> <a class="nav-link" href="https://www.youtube.com/PyTutorials">YouTube</a> </li> <li class="nav-item"> <a class="nav-link" href="https://github.com/brentvollebregt">GitHub</a> </li> <li class="nav-item "> <a class="nav-link" href="/about/">About</a> </li> </ul> </div> </div> </nav> <main role="main" class="container my-4"> <div class="row"> <div class="col-blog-content blog-main"> <h1 class="blog-post-title">Encryption and Decryption in Python</h1> <div class="mb-2"> <a href="/blog/archive/#2018" class="text-muted">16 Sep 2018</a> <a href="/blog/categories/#YouTube" class="badge badge-primary ml-2">YouTube</a> <a href="/blog/tags/#python" class="badge badge-warning">python</a> <a href="/blog/tags/#encryption" class="badge badge-warning">encryption</a> <a href="/blog/tags/#cyber-security" class="badge badge-warning">cyber-security</a> <img src="https://hitcounter.pythonanywhere.com/count/tag.svg" alt="Hits" class="post-hits"> </div> <p class="lead">In this post, I discuss how to encrypt and decrypt messages in Python using symmetric encryption. I will demonstrate how to create keys, save keys and how to encrypt messages and text.</p> <hr class="mt-3 mb-0"> <div class="post-content mt-3"> <div class="toc"> <ul> <li><a href="#installing-cryptography">Installing cryptography</a></li> <li><a href="#what-is-symmetric-encryption">What is Symmetric Encryption?</a></li> <li><a href="#getting-a-key">Getting a Key</a><ul> <li><a href="#storing-keys">Storing Keys</a></li> <li><a href="#reading-keys">Reading Keys</a></li> <li><a href="#generating-a-key-from-a-password">Generating a Key From A Password</a></li> </ul> </li> <li><a href="#encrypting">Encrypting</a></li> <li><a href="#decrypting">Decrypting</a><ul> <li><a href="#incorrect-keys">Incorrect Keys</a></li> </ul> </li> <li><a href="#demonstration">Demonstration</a></li> <li><a href="#encrypting-and-decrypting-files">Encrypting and Decrypting Files</a></li> </ul> </div> <p> <div class="embedded_yt my-3"> <div> <iframe allow="autoplay; encrypted-media" allowfullscreen src="https://www.youtube.com/embed/H8t4DJ3Tdrg"></iframe> </div> </div> </p> <p>Using the <a href="https://cryptography.io/en/latest/">cryptography</a> module in Python, we will use an implementation of AES called <a href="https://cryptography.io/en/latest/fernet/">Fernet</a> to encrypt data. I will also show you how to keep keys safe and how to use these methods on files.</p> <h2 id="installing-cryptography"> <span style="position:relative"><a class="anchor" href="#installing-cryptography"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Installing cryptography</span></h2> <p>Since Python does not come with anything that can encrypt files, we will need to use a third-party module.</p> <p><a href="https://github.com/dlitz/pycrypto">PyCrypto</a> is quite popular but since it does not offer built wheels, if you don't have Microsoft Visual C++ Build Tools installed, you will be told to install it. Instead of installing extra tools just to build this, I will be using the cryptography module. To install this, execute:</p> <div class="codehilite"><pre><span></span><code><span class="go">python -m pip install cryptography</span>
</code></pre></div> <p>To make sure it installed correctly, open IDLE and execute:</p> <div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">cryptography</span>
</code></pre></div> <p>If no errors appeared it has been installed correctly.</p> <h2 id="what-is-symmetric-encryption"> <span style="position:relative"><a class="anchor" href="#what-is-symmetric-encryption"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>What is Symmetric Encryption?</span></h2> <p><a href="https://en.wikipedia.org/wiki/Symmetric-key_algorithm">Symmetric encryption</a> is when a key is used to encrypt and decrypt a message, so whoever encrypted it can decrypt it. The only way to decrypt the message is to know what was used to encrypt it; kind of like a password.</p> <p>To use symmetric encryption, we will use the <a href="https://cryptography.io/en/latest/fernet/">Fernet class</a> which is an implementation of <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a></p> <blockquote> <p>Looking for a tutorial on asymmetric encryption? <a href="/blog/post/asymmetric-encryption-and-decryption-in-python/">I wrote one of those for Python too</a>.</p> </blockquote> <h2 id="getting-a-key"> <span style="position:relative"><a class="anchor" href="#getting-a-key"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Getting a Key</span></h2> <p>There are two main ways to get a key, we can either generate a new one or use one that has previously been generated. These keys need to be in a particular format so make sure to get this right.</p> <p>To generate a new random key, we can simply use</p> <div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">cryptography.fernet</span> <span class="kn">import</span> <span class="n">Fernet</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">Fernet</span><span class="o">.</span><span class="n">generate_key</span><span class="p">()</span>
</code></pre></div> <p>The variable <em>key</em> will now have the value of a URL safe base64 encoded key. When using these keys to encrypt, make sure to keep them safe, if you lose them you will not be able to decrypt your message.</p> <p>This key will have a type of bytes, so if you want a string you can call <code>key.decode()</code> to convert from UTF-8 to Pythons string type.</p> <h3 id="storing-keys"> <span style="position:relative"><a class="anchor" href="#storing-keys"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Storing Keys</span></h3> <p>One way of keeping your keys safe is to keep them in a file. To do this we can simply create/overwrite a file and put the key in it.</p> <div class="codehilite"><pre><span></span><code><span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;key.key&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>  <span class="c1"># Open the file as wb to write bytes</span>
<span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>  <span class="c1"># The key is type bytes still</span>
<span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div> <blockquote> <p>Make sure to keep these files safe and don't give them to anyone that you don't trust. Anyone with these keys can decrypt all past messages encrypted with this key.</p> </blockquote> <h3 id="reading-keys"> <span style="position:relative"><a class="anchor" href="#reading-keys"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Reading Keys</span></h3> <p>If you have previously saved your key using the method I showed, you can read the key back out using the following code.</p> <div class="codehilite"><pre><span></span><code><span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;key.key&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>  <span class="c1"># Open the file as wb to read bytes</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>  <span class="c1"># The key will be type bytes</span>
<span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div> <p>The key will now be read into the variable <em>key</em> and will be type bytes.</p> <h3 id="generating-a-key-from-a-password"> <span style="position:relative"><a class="anchor" href="#generating-a-key-from-a-password"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Generating a Key From A Password</span></h3> <p>If you want to base your key of a string that the user can input or some other form of input, you can create a key using this input.</p> <div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">from</span> <span class="nn">cryptography.hazmat.backends</span> <span class="kn">import</span> <span class="n">default_backend</span>
<span class="kn">from</span> <span class="nn">cryptography.hazmat.primitives</span> <span class="kn">import</span> <span class="n">hashes</span>
<span class="kn">from</span> <span class="nn">cryptography.hazmat.primitives.kdf.pbkdf2</span> <span class="kn">import</span> <span class="n">PBKDF2HMAC</span>

<span class="n">password_provided</span> <span class="o">=</span> <span class="s2">&quot;password&quot;</span>  <span class="c1"># This is input in the form of a string</span>
<span class="n">password</span> <span class="o">=</span> <span class="n">password_provided</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>  <span class="c1"># Convert to type bytes</span>
<span class="n">salt</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;salt_&#39;</span>  <span class="c1"># CHANGE THIS - recommend using a key from os.urandom(16), must be of type bytes</span>
<span class="n">kdf</span> <span class="o">=</span> <span class="n">PBKDF2HMAC</span><span class="p">(</span>
    <span class="n">algorithm</span><span class="o">=</span><span class="n">hashes</span><span class="o">.</span><span class="n">SHA256</span><span class="p">(),</span>
    <span class="n">length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
    <span class="n">salt</span><span class="o">=</span><span class="n">salt</span><span class="p">,</span>
    <span class="n">iterations</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>
    <span class="n">backend</span><span class="o">=</span><span class="n">default_backend</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">urlsafe_b64encode</span><span class="p">(</span><span class="n">kdf</span><span class="o">.</span><span class="n">derive</span><span class="p">(</span><span class="n">password</span><span class="p">))</span>  <span class="c1"># Can only use kdf once</span>
</code></pre></div> <p>The variable <em>key</em> will now have the value of a url safe base64 encoded key.</p> <blockquote> <p>It is recommended to use a different salt than the one shown here. You can generate a new salt using os.urandom(16). Make sure to use the same salt every time you convert a password to a key otherwise it will not produce the same result.</p> </blockquote> <h2 id="encrypting"> <span style="position:relative"><a class="anchor" href="#encrypting"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Encrypting</span></h2> <p>To encrypt a message, you will need a key (as previously discussed) and your message as type bytes (you can convert strings to bytes using <code>.encode()</code>).</p> <div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">cryptography.fernet</span> <span class="kn">import</span> <span class="n">Fernet</span>
<span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;my deep dark secret&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Fernet</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="n">encrypted</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>  <span class="c1"># Encrypt the bytes. The returning object is of type bytes</span>
</code></pre></div> <p>The variable <em>encrypted</em> will now have the value of the message encrypted as type bytes. This is also a URL safe base64 encoded key.</p> <h2 id="decrypting"> <span style="position:relative"><a class="anchor" href="#decrypting"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Decrypting</span></h2> <p>To decrypt a message, you will need the same key and the encrypted message (still in bytes).</p> <div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">cryptography.fernet</span> <span class="kn">import</span> <span class="n">Fernet</span>
<span class="n">encrypted</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;...encrypted bytes...&quot;</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Fernet</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="n">decrypted</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>  <span class="c1"># Decrypt the bytes. The returning object is of type bytes</span>
</code></pre></div> <p>The variable <em>decrypted</em> will now have the value of the original message (which was of type bytes).</p> <h3 id="incorrect-keys"> <span style="position:relative"><a class="anchor" href="#incorrect-keys"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Incorrect Keys</span></h3> <p>If a different key to the one used to encrypt is provided when decrypting, a <code>cryptography.fernet.InvalidToken</code> will be raised. </p> <p>Catching this error will allow you to tell if the incorrect key was provided; for example:</p> <div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">cryptography.fernet</span> <span class="kn">import</span> <span class="n">Fernet</span><span class="p">,</span> <span class="n">InvalidToken</span>
<span class="n">encrypted</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;...encrypted bytes...&quot;</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Fernet</span><span class="p">(</span><span class="n">incorrect_key</span><span class="p">)</span>  <span class="c1"># An example of providing the incorrect key</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">decrypted</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Valid Key - Successfully decrypted&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">InvalidToken</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># Catch any InvalidToken exceptions if the correct key was not provided</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid Key - Unsuccessfully decrypted&quot;</span><span class="p">)</span>
</code></pre></div> <h2 id="demonstration"> <span style="position:relative"><a class="anchor" href="#demonstration"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Demonstration</span></h2> <p>To show this in action, here is a properly constructed example.</p> <div class="codehilite"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">cryptography.fernet</span> <span class="kn">import</span> <span class="n">Fernet</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;my deep dark secret&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>  <span class="c1"># .encode() is used to turn the string to bytes</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">key</span> <span class="o">=</span> <span class="n">Fernet</span><span class="o">.</span><span class="n">generate_key</span><span class="p">()</span>  <span class="c1"># Store this key or get if you already have it</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="n">Fernet</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">encrypted</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">decrypted</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">message</span> <span class="o">==</span> <span class="n">decrypted</span>  <span class="c1"># The original message and decrypted bytes are the same</span>
<span class="kc">True</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div> <p>This example shows a key being generated, you will want to make sure you have already sorted your key out and put it in a file for later use.</p> <h2 id="encrypting-and-decrypting-files"> <span style="position:relative"><a class="anchor" href="#encrypting-and-decrypting-files"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Encrypting and Decrypting Files</span></h2> <p>We can also encrypt files using this method since files can be read as bytes. Simply open the file, read the bytes, encrypt the data and write them out to a new file. To encrypt:</p> <div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">cryptography.fernet</span> <span class="kn">import</span> <span class="n">Fernet</span>
<span class="n">key</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span> <span class="c1"># Use one of the methods to get a key (it must be the same when decrypting)</span>
<span class="n">input_file</span> <span class="o">=</span> <span class="s1">&#39;test.txt&#39;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;test.encrypted&#39;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>  <span class="c1"># Read the bytes of the input file</span>

<span class="n">fernet</span> <span class="o">=</span> <span class="n">Fernet</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="n">encrypted</span> <span class="o">=</span> <span class="n">fernet</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>  <span class="c1"># Write the encrypted bytes to the output file</span>

<span class="c1"># Note: You can delete input_file here if you want</span>
</code></pre></div> <p>And then to decrypt a file:</p> <div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">cryptography.fernet</span> <span class="kn">import</span> <span class="n">Fernet</span><span class="p">,</span> <span class="n">InvalidToken</span>
<span class="n">key</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span> <span class="c1"># Use one of the methods to get a key (it must be the same as used in encrypting)</span>
<span class="n">input_file</span> <span class="o">=</span> <span class="s1">&#39;test.encrypted&#39;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;test.txt&#39;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>  <span class="c1"># Read the bytes of the encrypted file</span>

<span class="n">fernet</span> <span class="o">=</span> <span class="n">Fernet</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">decrypted</span> <span class="o">=</span> <span class="n">fernet</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">decrypted</span><span class="p">)</span>  <span class="c1"># Write the decrypted bytes to the output file</span>

    <span class="c1"># Note: You can delete input_file here if you want</span>
<span class="k">except</span> <span class="n">InvalidToken</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid Key - Unsuccessfully decrypted&quot;</span><span class="p">)</span>
</code></pre></div> <blockquote> <p>As stated in <a href="https://cryptography.io/en/latest/fernet/#limitations">Fernet docs</a>, beware of large files; Fernet is ideal for encrypting data that easily fits in memory. You may need to think of methods to split larger files up to use this encryption method on large files.</p> </blockquote> </div> <nav class="blog-pagination text-center mb-5 mt-4"> <a class="btn btn-outline-primary mt-1" href="/blog/post/am-i-a-participant/">&larr; Am I A Participant</a> <a class="btn btn-outline-primary mt-1" href="/blog/post/asymmetric-encryption-and-decryption-in-python/">Asymmetric Encryption and D... &rarr;</a> </nav> <div id="disqus_thread"></div> <script>var disqus_config=function(){this.page.url='https://nitratine.net/blog/post/encryption-and-decryption-in-python/';this.page.identifier='https://nitratine.net/blog/post/encryption-and-decryption-in-python/';};(function(){var d=document,s=d.createElement('script');s.src='//nitratine.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div> <aside class="col-blog-sidebar blog-sidebar"> <div class="card p-3 mb-3 bg-light"> <h4 class="text-center text-lg-left">About</h4> <p class="mb-0">Owner of <a href="https://www.youtube.com/PyTutorials">PyTutorials</a> and creator of <a href="https://github.com/brentvollebregt/auto-py-to-exe">auto-py-to-exe</a>. I enjoy making quick tutorials for people new to particular topics in Python and tools that help fix small things.</p> </div> <div class="input-group mb-3"> <input id="search" type="text" class="form-control" placeholder="Search" aria-label="Search"> <div class="input-group-append"> <button id="search-submit" class="btn btn-outline-primary" type="button">Search</button> </div> </div> <script>let searchUrl="/search/";</script> <script type="text/javascript" defer src="/static/js/search.js"></script> <div class="card p-3 mb-3 bg-light"> <h4 class="text-center text-lg-left">Categories</h4> <ol class="list-unstyled mb-0 text-center text-lg-left"> <li> <a href="/blog/categories/#Apps">&#x1F4F1; Apps <span class="badge badge-primary ml-3">2</span> </a> </li> <li> <a href="/blog/categories/#General">&#x1F4F0; General <span class="badge badge-primary ml-3">7</span> </a> </li> <li> <a href="/blog/categories/#Investigations">&#x1F50D; Investigations <span class="badge badge-primary ml-3">2</span> </a> </li> <li> <a href="/blog/categories/#Projects">&#x1F4BE; Projects <span class="badge badge-primary ml-3">15</span> </a> </li> <li> <a href="/blog/categories/#Snippets">&#x2702; Snippets <span class="badge badge-primary ml-3">1</span> </a> </li> <li> <a href="/blog/categories/#Tools">&#x1F6E0; Tools <span class="badge badge-primary ml-3">3</span> </a> </li> <li> <a href="/blog/categories/#Tutorials">&#x1F4D6; Tutorials <span class="badge badge-primary ml-3">19</span> </a> </li> <li> <a href="/blog/categories/#YouTube">&#x1F3A5; YouTube <span class="badge badge-primary ml-3">15</span> </a> </li> </ol> </div> <div class="card p-3 mb-3 bg-light"> <h4 class="text-center text-lg-left">PyTutorials on YouTube</h4> <script src="https://apis.google.com/js/platform.js"></script> <div style="text-align: center"> <div class="g-ytsubscribe" data-channel="PrivateSplat" data-layout="full" data-count="default"></div> </div> </div> <div class="card p-3 mb-3 bg-light"> <h4 class="text-center text-lg-left">Recent Videos</h4> <div id="recent-yt-videos" class="yt_video_container"> <img src="https://img.youtube.com/vi/H8t4DJ3Tdrg/mqdefault.jpg" alt="Recent video thumbnail" onclick="window.open('https://www.youtube.com/watch?v=H8t4DJ3Tdrg', '_blank')"> <img src="https://img.youtube.com/vi/ksW59gYEl6Q/mqdefault.jpg" alt="Recent video thumbnail" onclick="window.open('https://www.youtube.com/watch?v=ksW59gYEl6Q', '_blank')"> <img src="https://img.youtube.com/vi/YPiHBtddefI/mqdefault.jpg" alt="Recent video thumbnail" onclick="window.open('https://www.youtube.com/watch?v=YPiHBtddefI', '_blank')"> <img src="https://img.youtube.com/vi/SQj17D1Q_6s/mqdefault.jpg" alt="Recent video thumbnail" onclick="window.open('https://www.youtube.com/watch?v=SQj17D1Q_6s', '_blank')"> <img src="https://img.youtube.com/vi/2kbeBzEQfXE/mqdefault.jpg" alt="Recent video thumbnail" onclick="window.open('https://www.youtube.com/watch?v=2kbeBzEQfXE', '_blank')"> <img src="https://img.youtube.com/vi/5JSloPGocSY/mqdefault.jpg" alt="Recent video thumbnail" onclick="window.open('https://www.youtube.com/watch?v=5JSloPGocSY', '_blank')"> </div> </div> <div class="card p-3 mb-3 bg-light"> <h4 class="text-center text-lg-left">Featured Sites</h4> <div class="featured-sites"> <a title="Emotionify" href="https://emotionify.nitratine.net/"> <img src="/static/img/featured-sites/emotionify.png" alt="Emotionify"> </a> <a title="Spotify Lyrics Viewer" href="https://spotify-lyrics-viewer.nitratine.net/"> <img src="/static/img/featured-sites/spotify-lyrics-viewer.png" alt="Spotify Lyrics Viewer"> </a> <a title="Hit Counter" href="https://hitcounter.pythonanywhere.com/"> <img src="/static/img/featured-sites/hit-counter.png" alt="Hit Counter"> </a> <a title="Monopoly Money" href="https://monopoly-money.nitratine.net/"> <img src="/posts/monopoly-money/banner.png" alt="Monopoly Money"> </a> </div> </div> </aside> </div> </main> <footer class="bg-dark py-4 px-1"> <div class="container"> <div class="d-flex justify-content-center"> <div class="top-group"> <div class="link-group"> <p class="header">Navigate</p> <a aria-current="page" class href="/">Home</a> <a href="/blog/">Blog</a> <a class="ml-2" href="/blog/categories/">Categories</a> <a class="ml-2" href="/blog/tags/">Tags</a> <a class="ml-2" href="/blog/archive/">Archive</a> <a href="/portfolio/">Portfolio</a> <a href="/about/">About</a> </div> <div class="link-group"> <p class="header">Popular Projects</p> <a href="/blog/post/auto-py-to-exe/">auto-py-to-exe</a> <a href="/blog/post/hit-counter/">hit-counter</a> <a href="/blog/post/whos-on-my-network/">whos-on-my-network</a> <a href="/blog/post/monopoly-money/">monopoly-money</a> </div> <div class="link-group"> <p class="header">Follow</p> <a href="https://github.com/brentvollebregt" class="with-icon"> <img src="/static/img/icons/github.svg" alt="GitHub Logo" style="filter: invert(1);"> GitHub </a> <a href="https://www.youtube.com/c/PyTutorials" class="with-icon"> <img src="/static/img/icons/youtube.svg" alt="YouTube Logo"> YouTube </a> <a href="/rss.xml" class="with-icon"><img src="/static/img/icons/rss.svg" alt="RSS Logo"> Nitratine RSS Feed </a> </div> </div> </div> <div class="mx-4"> <hr> </div> <p class="text-center m-0"> <small>Â© 2020 Brent Vollebregt</small> </p> </div> </footer> <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script> <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script> </body> </html>